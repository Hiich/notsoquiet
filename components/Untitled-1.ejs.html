<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://unpkg.com/moralis/dist/moralis.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/keccak256@latest/keccak256.js"></script>
<script src="https://cdn.jsdelivr.net/npm/merkletreejs@latest/merkletree.js"></script>
<link
  href="https://fonts.googleapis.com/icon?family=Material+Icons"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script>
  //Connect to Moralis server
  const serverUrl = 'https://yafnr4xrfcfl.usemoralis.com:2053/server' //"https://zjocjajpqlzg.usemoralis.com:2053/server";
  const appId = 'H6nLBLDv2aWRpY536dXt1eXnpMH5Z8Po8G807KM3' //"XVhG3Li0vsA50K5WOTZimyu3jhNyswsyqkGj6L6X";
  Moralis.start({ serverUrl, appId })
  //Constants
  const contractABI = [
    {
      inputs: [],
      name: 'ApprovalCallerNotOwnerNorApproved',
      type: 'error',
    },
    {
      inputs: [],
      name: 'ApprovalQueryForNonexistentToken',
      type: 'error',
    },
    {
      inputs: [],
      name: 'ApprovalToCurrentOwner',
      type: 'error',
    },
    {
      inputs: [],
      name: 'ApproveToCaller',
      type: 'error',
    },
    {
      inputs: [],
      name: 'BalanceQueryForZeroAddress',
      type: 'error',
    },
    {
      inputs: [],
      name: 'MintToZeroAddress',
      type: 'error',
    },
    {
      inputs: [],
      name: 'MintZeroQuantity',
      type: 'error',
    },
    {
      inputs: [],
      name: 'OwnerQueryForNonexistentToken',
      type: 'error',
    },
    {
      inputs: [],
      name: 'TransferCallerNotOwnerNorApproved',
      type: 'error',
    },
    {
      inputs: [],
      name: 'TransferFromIncorrectOwner',
      type: 'error',
    },
    {
      inputs: [],
      name: 'TransferToNonERC721ReceiverImplementer',
      type: 'error',
    },
    {
      inputs: [],
      name: 'TransferToZeroAddress',
      type: 'error',
    },
    {
      inputs: [],
      name: 'URIQueryForNonexistentToken',
      type: 'error',
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: true,
          internalType: 'address',
          name: 'owner',
          type: 'address',
        },
        {
          indexed: true,
          internalType: 'address',
          name: 'approved',
          type: 'address',
        },
        {
          indexed: true,
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
      ],
      name: 'Approval',
      type: 'event',
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: true,
          internalType: 'address',
          name: 'owner',
          type: 'address',
        },
        {
          indexed: true,
          internalType: 'address',
          name: 'operator',
          type: 'address',
        },
        {
          indexed: false,
          internalType: 'bool',
          name: 'approved',
          type: 'bool',
        },
      ],
      name: 'ApprovalForAll',
      type: 'event',
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: true,
          internalType: 'address',
          name: 'previousOwner',
          type: 'address',
        },
        {
          indexed: true,
          internalType: 'address',
          name: 'newOwner',
          type: 'address',
        },
      ],
      name: 'OwnershipTransferred',
      type: 'event',
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: true,
          internalType: 'address',
          name: 'from',
          type: 'address',
        },
        {
          indexed: true,
          internalType: 'address',
          name: 'to',
          type: 'address',
        },
        {
          indexed: true,
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
      ],
      name: 'Transfer',
      type: 'event',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: 'to',
          type: 'address',
        },
        {
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
      ],
      name: 'approve',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: '_to',
          type: 'address',
        },
        {
          internalType: 'uint256',
          name: '_mintAmount',
          type: 'uint256',
        },
      ],
      name: 'mint',
      outputs: [],
      stateMutability: 'payable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'bool',
          name: '_state',
          type: 'bool',
        },
      ],
      name: 'pause',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [],
      name: 'renounceOwnership',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: 'from',
          type: 'address',
        },
        {
          internalType: 'address',
          name: 'to',
          type: 'address',
        },
        {
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
      ],
      name: 'safeTransferFrom',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: 'from',
          type: 'address',
        },
        {
          internalType: 'address',
          name: 'to',
          type: 'address',
        },
        {
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
        {
          internalType: 'bytes',
          name: '_data',
          type: 'bytes',
        },
      ],
      name: 'safeTransferFrom',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: 'operator',
          type: 'address',
        },
        {
          internalType: 'bool',
          name: 'approved',
          type: 'bool',
        },
      ],
      name: 'setApprovalForAll',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'string',
          name: '_newBaseURI',
          type: 'string',
        },
      ],
      name: 'setBaseURI',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'uint256',
          name: '_newCost',
          type: 'uint256',
        },
      ],
      name: 'setCost',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'uint256',
          name: '_newmaxMintAmount',
          type: 'uint256',
        },
      ],
      name: 'setmaxMintAmount',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'bool',
          name: '_whitelistActive',
          type: 'bool',
        },
      ],
      name: 'setWhitelistActive',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'bytes32',
          name: '_whitelistMerkleRoot',
          type: 'bytes32',
        },
      ],
      name: 'setWhitelistMerkleRoot',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: 'from',
          type: 'address',
        },
        {
          internalType: 'address',
          name: 'to',
          type: 'address',
        },
        {
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
      ],
      name: 'transferFrom',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: 'newOwner',
          type: 'address',
        },
      ],
      name: 'transferOwnership',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'uint256',
          name: 'amount',
          type: 'uint256',
        },
        {
          internalType: 'bytes32[]',
          name: 'proof',
          type: 'bytes32[]',
        },
      ],
      name: 'whitelistMint',
      outputs: [],
      stateMutability: 'payable',
      type: 'function',
    },
    {
      inputs: [],
      stateMutability: 'nonpayable',
      type: 'constructor',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: 'owner',
          type: 'address',
        },
      ],
      name: 'balanceOf',
      outputs: [
        {
          internalType: 'uint256',
          name: '',
          type: 'uint256',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'cost',
      outputs: [
        {
          internalType: 'uint256',
          name: '',
          type: 'uint256',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
      ],
      name: 'getApproved',
      outputs: [
        {
          internalType: 'address',
          name: '',
          type: 'address',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'address',
          name: 'owner',
          type: 'address',
        },
        {
          internalType: 'address',
          name: 'operator',
          type: 'address',
        },
      ],
      name: 'isApprovedForAll',
      outputs: [
        {
          internalType: 'bool',
          name: '',
          type: 'bool',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'maxMintAmount',
      outputs: [
        {
          internalType: 'uint256',
          name: '',
          type: 'uint256',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'maxSupply',
      outputs: [
        {
          internalType: 'uint256',
          name: '',
          type: 'uint256',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'maxWhitelistPerWallet',
      outputs: [
        {
          internalType: 'uint256',
          name: '',
          type: 'uint256',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'merkleRoot',
      outputs: [
        {
          internalType: 'bytes32',
          name: '',
          type: 'bytes32',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'name',
      outputs: [
        {
          internalType: 'string',
          name: '',
          type: 'string',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'owner',
      outputs: [
        {
          internalType: 'address',
          name: '',
          type: 'address',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
      ],
      name: 'ownerOf',
      outputs: [
        {
          internalType: 'address',
          name: '',
          type: 'address',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'paused',
      outputs: [
        {
          internalType: 'bool',
          name: '',
          type: 'bool',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'bytes4',
          name: 'interfaceId',
          type: 'bytes4',
        },
      ],
      name: 'supportsInterface',
      outputs: [
        {
          internalType: 'bool',
          name: '',
          type: 'bool',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'symbol',
      outputs: [
        {
          internalType: 'string',
          name: '',
          type: 'string',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'uint256',
          name: 'tokenId',
          type: 'uint256',
        },
      ],
      name: 'tokenURI',
      outputs: [
        {
          internalType: 'string',
          name: '',
          type: 'string',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [],
      name: 'totalSupply',
      outputs: [
        {
          internalType: 'uint256',
          name: '',
          type: 'uint256',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
  ]

  const contractAddress = '0x14780985190d9CB39496750c7E18ef0Ab451086F'

  var address = ''
  let blankStuff = []
  let user = Moralis.User.current()
  if (user) {
    console.log('connected')
    address = user.get('ethAddress')
    console.log(address)
    jQuery(document).ready(function ($) {
      $("a[href='https://staging11.nebula41.io/mint/']").text(
        address.substring(0, 4) + '...' + address.substring(39)
      )
      //   getBlankNFTs(address);
    })
  } else {
    $(document).ready(function () {
      $('#menu-item-195 .sub-menu').hide()
    })
  }

  // //METHODS
  // async function loginMeta() {
  //   user = Moralis.User.current();
  //   if (!user) {
  //     try {
  //       user = await Moralis.authenticate();
  //       address = user.get("ethAddress");
  //       // $("a[href='https://staging11.nebula41.io/mint/']").text(
  //       //   address.substring(0, 4) + "..." + address.substring(39)
  //       // );
  //       $(document).ready(function () {
  //         $("#menu-item-195 .sub-menu").show();
  //       });
  //       // getBlankNFTs(address);
  //       console.log(user);
  //       location.reload();
  //     } catch (error) {
  //       console.log(error);
  //     }
  //   }
  // }

  async function mint() {
    if (user) {
      await Moralis.enableWeb3()
      //const contract = new this.web3.eth.Contract(contractABI, contractAddress);
      const proof = await fetch(
        `https://wildverse.mypinata.cloud/ipfs/QmdsB5zEhwRr6cUk2zcAbC6MLd9fCtGHhnQPFueN4iUeAA/${user.get(
          'ethAddress'
        )}.json`,
        {
          headers: {
            'Content-Type': 'application/json',
            Accept: 'application/json',
          },
        }
      )
      console.log(proof)
      const options = {
        contractAddress: contractAddress,
        functionName: 'mint',
        abi: contractABI,
        msgValue: 0,
        params: {
          _to: user.get('ethAddress'),
          _mintAmount: 1,
        },
      }
      try {
        var reciept = await Moralis.executeFunction(options)
        // var tokenID = reciept.events.TransferSingle.returnValues.id;
        // return tokenID;
      } catch (error) {
        console.log(error)
      }
    } else {
      toastr.error('Please connect wallet')
    }
  }
  function logOuts() {
    Moralis.User.logOut()
    location.reload()
  }

  //   jQuery(document).ready(function ($) {
  //     $("#mint-remaining").text("Loading.../10101 Remaining");
  //     getMinted().then((xxx) => {
  //       console.log(xxx);
  //       $("#mint-remaining").text(10101 - xxx + "/10101 Remaining");
  //     });
  //   });

  jQuery(document).ready(function ($) {
    $('#menu-item-195 > a').on('click', function (e) {
      e.preventDefault()
      loginMeta()
    })
  })

  jQuery(document).ready(function ($) {
    $('#menu-item-382 a').on('click', function (e) {
      e.preventDefault()
      logOuts()
    })
  })

  //alert(Scenery["WONDERLAND"]);
  function sleep(milliseconds) {
    var start = new Date().getTime()
    for (var i = 0; i < 1e7; i++) {
      if (new Date().getTime() - start > milliseconds) {
        break
      }
    }
  }

  jQuery(document).ready(function ($) {
    $('#mintButton').on('click', function (e) {
      e.preventDefault()
      mint()
    })
  })
</script>
